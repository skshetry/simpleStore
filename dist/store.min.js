"use strict";(function(a,b){if("function"==typeof define&&define.amd)define(["exports","regenerator-runtime"],b);else if("undefined"!=typeof exports)b(exports,require("regenerator-runtime"));else{var c={exports:{}};b(c.exports,a.regeneratorRuntime),a.undefined=c.exports}})(void 0,function(a,b){"use strict";function c(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function d(a){return function(){var b=this,d=arguments;return new Promise(function(e,f){function g(a){c(i,e,f,g,h,"next",a)}function h(a){c(i,e,f,g,h,"throw",a)}var i=a.apply(b,d);g(void 0)})}}function e(a){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e(a)}function f(a){return i(a)||h(a)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function i(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function j(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){k(a,b,c[b])})}return a}function k(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function l(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function m(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function n(a,b,c){return b&&m(a.prototype,b),c&&m(a,c),a}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o=function(a){return a&&a.__esModule?a:{default:a}}(b),p=function(){function a(b,c){l(this,a),this._data=void 0,this.key=b,this._connectedComponents=[],a.instances=j({},a.instances,k({},b,this)),"function"==typeof c&&c()}return n(a,[{key:"get",value:function(){// Should check for `undefined` by the receiver
return Array.isArray(this._data)?f(this._data):"object"===e(this._data)?j({},this._data):this._data}},{key:"connect",value:function(a,b){this._connectedComponents.includes(a)||(this._connectedComponents=[].concat(f(this._connectedComponents),[a])),a.state=a.state||{},"function"==typeof b&&b()}},{key:"set",value:function(){var a=d(o.default.mark(function a(b){return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._data===b){a.next=4;break}return this._data=b,a.next=4,this._syncState();case 4:return a.abrupt("return",this._data);case 5:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()},{key:"disconnect",value:function(){var a=d(o.default.mark(function a(b){return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._connectedComponents.filter(function(a){return b!==a});case 2:this._connectedComponents=a.sent,console.warn("Disconnected.");case 4:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()},{key:"connections",value:function(){// list connections
return this._connectedComponents}},{key:"_syncState",value:function(){var a=d(o.default.mark(function a(){var b=this;return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.all(this._connectedComponents.map(function(){var a=d(o.default.mark(function a(c){return o.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c.setState(k({},b.key,b._data));case 1:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}()));case 2:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()}],[{key:"list",value:function(b){return b?a.instances[b]:a.instances;// check for undefined in case the key doesn't
}}]),a}();a.default=p});
