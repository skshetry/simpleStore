(function(a,b){if("function"==typeof define&&define.amd)define(["exports","regenerator-runtime"],b);else if("undefined"!=typeof exports)b(exports,require("regenerator-runtime"));else{var c={exports:{}};b(c.exports,a.regeneratorRuntime),a.store=c.exports}})(this,function(a,b){"use strict";function c(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var g=function(a){return a&&a.__esModule?a:{default:a}}(b),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},j=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=function(){function a(b,c){f(this,a),this._data=void 0,this.key=b,this._connectedComponents=[],a.instances=i({},a.instances,e({},b,this)),"function"==typeof c&&c()}return j(a,[{key:"get",value:function(){return Array.isArray(this._data)?[].concat(d(this._data)):"object"===h(this._data)?i({},this._data):this._data}},{key:"connect",value:function(a,b){this._connectedComponents.includes(a)||(this._connectedComponents=[].concat(d(this._connectedComponents),[a])),a.state=a.state||{},"function"==typeof b&&b()}},{key:"set",value:function(){var a=c(g.default.mark(function a(b){return g.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._data===b){a.next=4;break}return this._data=b,a.next=4,this._syncState();case 4:return a.abrupt("return",this._data);case 5:case"end":return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:"disconnect",value:function(){var a=c(g.default.mark(function a(b){return g.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._connectedComponents.filter(function(a){return b!==a});case 2:this._connectedComponents=a.sent,console.warn("Disconnected.");case 4:case"end":return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:"connections",value:function(){return this._connectedComponents}},{key:"_syncState",value:function(){var a=c(g.default.mark(function a(){var b=this;return g.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.all(this._connectedComponents.map(function(){var a=c(g.default.mark(function a(c){return g.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c.setState(e({},b.key,b._data));case 1:case"end":return a.stop();}},a,b)}));return function(){return a.apply(this,arguments)}}()));case 2:case"end":return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()}],[{key:"list",value:function(b){return b?a.instances[b]:a.instances}}]),a}();a.default=k});
